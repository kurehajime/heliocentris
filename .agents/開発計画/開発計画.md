# 開発計画

## フェイズ１
Vite + React + TypeScriptでHello,worldを作成する

## フェイズ２

基本的なゲーム画面を描画するために必要なtypeやclassやコンポーネントを仮実装する。
この時点では中身まで実装する必要はない。

### フェイズ３

画面にグリッドを表示する。
グリッドは縦20行、横10列とする。
グリッドには動作確認用に中央下に2x2のブロックを配置しておく。

### フェイズ４

タッチ操作で地面を左右に移動できるようにする。

1. **ドラッグ検出の実装**: SVG全体でpointer/touchイベントを拾う。ドラッグ開始位置を記録し、ドラッグ中は最新のポインタ座標と差分を保持する。
2. **セル単位の移動量算出**: ドラッグ距離(px)をセル幅で割り、Math.roundでセル単位に変換。差分が1セル以上になったタイミングでGameStateに反映する。
3. **セルごとの地面反映**: まずはFixedFieldそのものをセル単位で組み替え、ドラッグ量に応じて左右へ再配置する。

ピクセル単位のオフセット表示は取りやめたため、描画用のダミー列も導入しない。

### フェイズ５

ブロックの落下、積み上げ処理を実装する。
落下中のブロックは左右移動の対象にならず、必ず中央に落ちる。

### フェイズ６
落下ブロックの押し出し処理を実装する。
左右の移動方向を判定し、地面にあるブロックが落下ブロックと被ってしまうときは、落下ブロックを移動方向に押し出す。

### フェイズ7
ゴースト表示を実装する

### フェイズ8
手動落下機能を実装する。
ドラッグ移動した際、タップ開始時の場所から換算してY方向の移動量がX方向の移動量より多い場合、
グリッド換算値に応じて落下ブロックを即座に落下させる。

## フェイズ９
ブロックの消去機能を実装する
ブロックが横一列に揃った時、その列をDeleting状態に変更し、一定時間経過後にEmpty状態にする。

## フェイズ10
落下予定ミノの初期回転状態をランダムにする
回転状態は0, 90, 180, 270度の4パターンとする

## フェイズ11
落下ミノ選択アルゴリズムを実装する

## フェイズ12
UIを整理する。
NEXT欄、状態更新ボタンをなくす。
フィールドを中央に置く。

## フェイズ13

ゲームオーバー処理を実装する
一番上の行の背景を薄い赤色にする。
その行にブロックが積み上がった場合、ゲームオーバーとし、操作を受け付けなくする。
ニューゲームボタンをオーバレイで表示し、ニューゲームを開始できるようにする。

## フェイズ14
徐々に落下速度が上がるようにする
以下の法則でレベルを上げる。レベルは画面に表示しない。
* 最初はレベル1
* 最初の1つのミノを落下させた時点でレベル2
* 最初にブロックを消した時点でレベル3
* 以降、5個のミノを落下させるごとにレベルが1上がる

レベル1の落下速度をベース速度とする。ベース速度=400ms。
それ移行は
FALL_INTERVAL_MS = ベース速度 ÷ √(レベル)

## フェイズ15

Github Pagesで公開する

## フェイズ16
誤操作が多いので、操作方法を微修正する
落下中のミノが赤色のエリア(上段１行)に被るorそれより上にある間はクリックによる即時落下を無効化する

## フェイズ１７
キーボードの左右でも操作できるようにする
キーボードの下でも即時落下できるようにする

## フェイズ１８
グリッドの１〜５行までを使って消した行数を表示する
グリッドの背景を透明にする。
背後にスコア用のレイヤーを表示する

## フェイズ１９
ゲーム開始時にright.svgとleft.svgを中央のブロックの両側にオーバレイ表示する
一度でもスワイプしたらオーバレイを消す

(記述途中)
