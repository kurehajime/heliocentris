# ゲームループ

## メインループ
requestAnimationFrameでループする。
ただし、tick関数内で一定時間経過していない場合は更新せず、次のフレームを待つ。
ゲームスピードはゲーム進捗に応じて変化する。

### 落下
一定時間ごとにブロックを１マス落下させる。
ブロックが着地した場合は、ブロックをFixing状態に変更する。
Fixing状態のブロックは一定時間経過後にFixed状態になる。

### 消去
FixingまたはFixed状態のブロックが一定数以上連結している場合は、Deleting状態に変更する。
Deleting状態のブロックは一定時間経過後にEmpty状態になる。

### 次のブロック生成
現在の落下ブロックがFixed状態になり、Deleting状態の解消まで終わった場合、
NextMinoQueueから次のブロックを取り出してFalling状態で生成する。

## ユーザー操作
ユーザーの横ドラッグ操作に応じて、地面のブロックを左右に移動させる。
ドラッグ操作はSVG全体で受け付ける。
ドラッグ中の移動はピクセル単位で行う。
一定量の移動があった場合はGameStateにもマス単位で反映させる。
ドラッグが完了したらグリッドに沿うように配置する。
このあたりの処理はiroawaseのコードを参考にする。

落下中のブロックを左右に押し出すこともできる。

無限ループの左右移動を実装するために、フィールドの左右にダミーの列を追加して表示する。
例えば、フィールドの幅が10マスの場合、実際には12マス分のデータを持ち、0列目と11列目はそれぞれ10列目と1列目と同じデータを表示する。
(これはゲーム管理ではなく描画上の工夫で行う)

座標のズレ幅を表現するために、FixedFieldとFallingFieldの両方でピクセル単位のオフセット値を持つ。
