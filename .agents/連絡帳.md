# 連絡帳

人間に確認OKをもらえたら作業内容を3行程度にまとめて日付付きでここに記載してください

## 2025-11-12
- フェイズ1（Vite + React + TypeScript の Hello World 環境構築）を手動で完了。
- これで次フェイズの型設計・ドキュメント整理に着手できる状態。
- 追加作業や確認事項があれば指示をお願いします。

## 2025-11-13 (フェイズ2画面仮実装)
- GameState/Field/Mino系の型とGameManagerクラスの雛形を作成し、状態遷移と初期化の入口を整備。
- GameElement/FieldElement/BlockElementを追加してSVGグリッドに固定＋落下フィールドを合成描画、Next表示と仮tickボタンを配置。
- Appをゲーム画面用に刷新し、レイアウト/配色を専用CSSで調整。`npm run build`でビルド成功を確認。

## 2025-11-13 (フェイズ2 SVGレイアウト)
- GameElement全体を単一SVG化し、フィールド＋ネクスト欄を正方形ビュー内で描画するようFieldElement/Sidebarを再構成。
- Appをゲーム画面のみの表示にし、CSSでコンテナ自体を正方形に固定してタイトル/説明テキストを撤去。
- SVG内でのネクスト表示や状態更新ボタンも描画し直し、`npm run build`で正常ビルドを確認。

## 2025-11-13 (中央配置＋角丸撤廃)
- root/appのflexを調整し、GameElementの実サイズを`min(90vmin, 640px)`に固定して画面中央へ寄せた。
- FieldElement/BlockElement/Sidebar内矩形から角丸指定を除去し、SVG/背景矩形もフラット形状に統一。
- `npm run build`で通ることを確認済み。

## 2025-11-13 (グリッド＋選択抑止)
- FieldElementへグリッドライン描画を追加し、薄い補助線でマス目を視認できるようにした。
- body/ゲームSVGに`user-select: none`を設定し、NEXTなどのテキストが選択されないよう制御。
- `npm run build`でビルドOK。

## 2025-11-13 (フェイズ3デモブロック)
- GameManager初期化時に底部中央へ2x2の固定ブロックを埋め込み、フェイズ3要件のグリッド表示を準備。
- セルのコピーを確保してデモ用ブロックを塗り分け、今後の描画・ロジックに影響しないよう分離。
- `npm run build`で動作確認済み。

## 2025-11-13 (フェイズ4計画更新)
- 開発計画にフェイズ4の詳細ステップ(ドラッグ検出/セル換算/地面オフセット/描画補正/ループ準備)を追加してタスクを明確化。
- まずセル単位移動→後でピクセル単位に拡張する流れを文書化して、実装順序を共有。
- 引き続きフェイズ4実装に着手できる状態。

## 2025-11-13 (フェイズ4計画微修正)
- groundOffset等のオフセット処理は後工程で扱う方針に修正し、フェイズ4ではセル単位のFixedField組み替えまでに範囲を限定。
- 計画ドキュメントを更新し、まずはドラッグ→セル再配置→(後でオフセット)という優先順位を明記。
- 実装タスクの見通しが揃ったため、この方針でフェイズ4作業を継続予定。

## 2025-11-13 (フェイズ4 セル移動実装)
- GameStateに`groundShift`を追加し、GameManagerで列入れ替えによる地面シフトを扱える`shiftGroundByCells`を実装。
- SVG上でpointerドラッグを受け取り、移動距離(px)→セル数へ換算して随時`shiftGroundByCells`を適用。セル単位で即時に地面が移動する。
- `npm run build`で動作確認済み。今後はピクセル単位のオフセットやループ表示に発展予定。

## 2025-11-13 (フェイズ5方針変更)
- ピクセル単位の表示/操作は見送る方針に切り替え、フェイズ5はセル単位挙動の安定化とループ表示の実装を主軸とするよう計画を整理。
- 追加のコード変更は不要だったため、ドキュメントのみ確認。
- 今後はドラッグ安定化・スナップ調整・ダミー列描画に集中予定。

## 2025-11-13 (ダミー列撤回)
- オフセット実装を取りやめたことに合わせ、描画用ダミー列も不要と判断して開発計画を更新。
- フェイズ4のTODOに「ダミー列なし」方針を追記し、セル単位の挙動改善に専念できるよう整理。
- コード変更はなく、ドキュメント調整のみ。

## 2025-11-13 (フェイズ5 落下処理)
- GameStateに`activeMino`を追加し、GameManagerでNextキューからミノを生成→中央へスポーン→tickごとに1行落下→着地で固定する流れを実装。
- 固定時はFixedFieldへセルを焼き付け、FallingFieldは`activeMino`から都度再構成されるため描画が同期。
- `npm run build`でビルド完了。落下中のブロックは地面シフトの影響を受けず中央に落ち続ける。

## 2025-11-13 (ゲームループ導入)
- GameElement内で`requestAnimationFrame`ループを構築し、800msごとに自動で`GameManager.tick`を呼び出して落下を進行。
- ループ開始/停止処理をuseEffectで管理し、従来のボタン手動tickも併用可能な構成にした。
- `npm run build`で正常動作を確認。

## 2025-11-13 (フェイズ6 押し出し)
- 地面シフト時に落下ブロックと固定ブロックが重なった場合、ドラッグ方向へ1セルずつ押し出すロジックを`GameManager.shiftGroundByCells`に追加。
- 最初に衝突していないか判定し、必要な分だけ横移動させてからFallingFieldを再構築することで描画と同期。
- `npm run build`でビルドOK。
